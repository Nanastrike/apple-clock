<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.chart.PieChart?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.*?>

<BorderPane xmlns:fx="http://javafx.com/fxml"
            fx:controller="controller.StatisticsController"
            prefWidth="900" prefHeight="600"
            stylesheets="@/css/pie-colors.css">

    <!-- 顶部工具区 -->
    <top>
        <VBox spacing="10">

        <!-- 第一行：标题 & 视图切换 -->
        <HBox alignment="CENTER" spacing="10">
            <Button fx:id="selectDateRangeButton" text="%stats.selectDateRange" onAction="#onDateRangeButtonClicked"/>
            <Button text="%stats.filterEvents" onAction="#openWorkTypeSelection"/>
            <Button fx:id="toggleViewButton" text="%stats.toggleView" onAction="#handleToggleView"/>
        </HBox>
        <!-- 隐藏的日期范围弹出面板 -->
        <VBox fx:id="dateRangePanel"
              spacing="10"
              visible="false"
              style="-fx-background-color: #FFFFFF; -fx-border-color: #CCCCCC; -fx-border-radius: 8;">

        <HBox spacing="10" alignment="CENTER">
            <Button text="%stats.today"      onAction="#onTodayClicked"/>
            <Button text="%stats.yesterday"      onAction="#onYesterdayClicked"/>
            <Button text="%stats.last7Days"   onAction="#onLast7DaysClicked"/>
            <Button text="%stats.last30Days"  onAction="#onLast30DaysClicked"/>
        </HBox>
        <HBox spacing="10" alignment="CENTER">
            <DatePicker fx:id="startDatePicker"/>
            <Label text="%stats.rangeTo"/>
            <DatePicker fx:id="endDatePicker"/>
        </HBox>
            <HBox alignment="CENTER">
                <Button text="%button.confirm" onAction="#onConfirmDateRange"/>
            </HBox>
        </VBox>
        </VBox>
    </top>

    <!-- 中心区域改造为 StackPane：
         - 当展示「饼图+历史记录」时，用 SplitPane 自动横竖排布
         - 当展示「日志列表」时，直接把 logScrollPane 放最上层 -->
    <center>
        <StackPane fx:id="centerPane">

            <!-- —— 默认可见：SplitPane —— -->
            <SplitPane fx:id="splitPane" dividerPositions="0.5">
                <items>
                    <!-- 左 / 上：饼图 + 概览 -->
                    <VBox fx:id="statsContainer" spacing="10" alignment="TOP_CENTER">
                        <PieChart fx:id="pieChart"
                                  prefHeight="400" prefWidth="400"/>
                        <Label fx:id="noDataLabel"
                               text="No Records Found"
                               style="-fx-text-fill: grey; -fx-font-size:16px;"
                               visible="false"/>
                    </VBox>

                    <!-- 右 / 下：累加记录列表 -->
                    <ScrollPane fx:id="recordsScrollPane" fitToWidth="true">
                        <VBox fx:id="recordsContainer" spacing="6" />
                    </ScrollPane>
                </items>
            </SplitPane>

            <!-- —— 日志视图（互斥） —— -->
            <ScrollPane fx:id="logScrollPane"
                        fitToWidth="true"
                        visible="false">
                <VBox fx:id="logListContainer" spacing="10" />
            </ScrollPane>

        </StackPane>
    </center>
</BorderPane>
